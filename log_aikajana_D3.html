<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="UTF-8" />
    <title>D3 Logaritminen Aikajana</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }

        h1 {
            margin: 2em;
        }

        #timeline-container {
            margin: 0 2em 2em 2em;
            background: white;
            padding-top: 1em;
            overflow: hidden;
        }

        svg {
            display: block;
            overflow: visible;
        }

        .event-label {
            font-size: 12px;
            fill: #333;
            pointer-events: none;
        }

        .event-bg {
            fill: #f0f0f0;
        }

        .tick text {
            font-size: 10px;
        }

        .decade-label {
            font-weight: bold;
            font-size: 12px;
            fill: #000;
        }
    </style>
</head>

<body>
    <h1>Logaritminen aikajana (D3)</h1>
    <div id="timeline-container">
        <svg id="timeline" viewBox="0 0 500 800" preserveAspectRatio="xMinYMin meet"></svg>
    </div>

    <script>
        const data = [
            // Päätapahtumat, yksi per dekadi
            { label: "Alkuräjähdys (13.8 mrd v)", log: 17.64, main: true },
            { label: "Elämän synty (3.8 mrd v)", log: 17.08, main: true },
            { label: "Monisoluiset (1.2 mrd v)", log: 16.38, main: true },
            { label: "Dinosaurukset kuolevat sukupuuttoon (66 milj. v)", log: 15.82, main: true },
            { label: "Hominidien ja simpanssien sukulinjat eroavat (6 milj. v)", log: 13.78, main: true },
            { label: "Australopithecus kehittyy (4 milj. v)", log: 13.6, main: true },
            { label: "Homo erectus käyttää tulta (2 milj. v)", log: 13.3, main: true },
            { label: "Homo sapiens (300 000 v)", log: 12.98, main: true },
            { label: "Kirjoitettu historia (5200 v)", log: 11.72, main: true },
            { label: "Antiikin Kreikka (2500 v)", log: 10.9, main: true },
            { label: "Moderni tiede (400 v)", log: 10.6, main: true },
            { label: "Internet (32 v)", log: 9.0, main: true },

            // Muut tapahtumat
            { label: "Fotosynteesi (3.5 mrd v)", log: 17.05 },
            { label: "Eukaryootit (2 mrd v)", log: 16.80 },
            { label: "Neoliittinen vallankumous (9500 v)", log: 11.4 },
            { label: "Ensimmäiset kaupungit (6300 v)", log: 11.3 },
            { label: "Rooma (2000 v)", log: 10.8 },
            { label: "Pyramidit (4500 v)", log: 11.15 },
            { label: "Gutenbergin kirjapaino (580 v)", log: 10.4 },
            { label: "Kolumbus löytää Amerikan (530 v)", log: 10.3 },
            { label: "Ranskan vallankumous (230 v)", log: 10.15 },
            { label: "Teollinen vallankumous (250 v)", log: 10.0 },
            { label: "Ensimmäinen maailmansota (110 v)", log: 9.85 },
            { label: "Toinen maailmansota (80 v)", log: 9.7 },
            { label: "Tietokoneet (75 v)", log: 9.5 },
            { label: "1 vuosi sitten", log: 7.5 },
            { label: "Aurinkokunta syntyy (4.6 mrd v)", log: 17.16 },
            { label: "Tähdet syttyvät (13.4 mrd v)", log: 17.61 },
            { label: "Galaksien synty (13.6 mrd v)", log: 17.63 }
        ];

        const margin = { top: 20, right: 100, bottom: 20, left: 90 };
        const width = 500;
        const height = 800;
        const contentHeight = height - margin.top - margin.bottom;

        const svg = d3.select("#timeline");

        let y = d3.scaleLog()
            .domain([1e0, 1e18])
            .range([contentHeight, 0]);

        const g = svg.append("g").attr("transform", `translate(${margin.left}, ${margin.top})`);

        const axisG = g.append("g");
        const decadeG = g.append("g").attr("class", "decades");
        const eventGroup = g.append("g").attr("class", "events");

        function updateAxis(scale) {
            const yAxis = d3.axisLeft(scale)
                .ticks(10, ".1e")
                .tickSize(-10);

            axisG.call(yAxis);

            const decades = d3.range(0, 19);
            const format = d3.format(".0f");
            decadeG.selectAll("text")
                .data(decades)
                .join("text")
                .attr("class", "decade-label")
                .attr("x", -70)
                .attr("y", d => scale(Math.pow(10, d)))
                .attr("dy", "0.35em")
                .text(d => `${format(d)}`);
        }

        function updateEvents(scale) {
            const mainEvents = data.filter(d => d.main);
            const otherEvents = data.filter(d => !d.main);

            const allEvents = [...mainEvents, ...otherEvents];

            const events = eventGroup.selectAll("g")
                .data(allEvents)
                .join("g")
                .attr("transform", d => `translate(0, ${scale(Math.pow(10, d.log))})`);

            events.selectAll("rect")
                .data(d => [d])
                .join("rect")
                .attr("x", d => d.main ? 15 : 140)
                .attr("y", -10)
                .attr("width", 300)
                .attr("height", 18)
                .attr("class", "event-bg");

            events.selectAll("text")
                .data(d => [d])
                .join("text")
                .attr("class", "event-label")
                .attr("x", d => d.main ? 20 : 145)
                .attr("dy", "0.3em")
                .text(d => `${d.label}`);
        }

        updateAxis(y);
        updateEvents(y);

        const zoomBehavior = d3.zoom()
            .scaleExtent([0.5, 20])
            .translateExtent([[0, 0], [width, height]])
            .on("zoom", zoomed);

        svg.call(zoomBehavior);

        function zoomed({ transform }) {
            const newY = transform.rescaleY(y);
            updateAxis(newY);
            updateEvents(newY);
        }
    </script>
</body>

</html>